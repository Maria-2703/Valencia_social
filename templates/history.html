{% extends "base.html" %}

{% block content %}

<div class="container py-5">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-serif fw-bold mb-0" style="color: var(--secondary-color);">Historial de Predicciones</h2>
            <p class="text-muted mb-0">Registro completo de las consultas realizadas a la IA.</p>
        </div>
        <div class="d-flex gap-2">
            <button onclick="window.print()" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-print me-2"></i> Imprimir
            </button>
            
            <a href="/stats/predicciones" class="btn btn-sm text-white shadow-sm" style="background-color: var(--secondary-color); border-color: var(--secondary-color);">
                <i class="fas fa-chart-pie me-2"></i> Ver Gráficas
            </a>
        </div>
    </div>

    <div class="card border-0 shadow-sm overflow-hidden" style="border-radius: 15px;">
        <div class="card-body p-0">
            
            {% if records %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th class="ps-4 py-3 text-secondary text-uppercase small">Municipio / CP</th>
                                <th class="py-3 text-secondary text-uppercase small"><i class="fas fa-thermometer-half me-1"></i> Clima</th>
                                <th class="py-3 text-secondary text-uppercase small text-end"><i class="fas fa-users me-1"></i> Hab.</th>
                                <th class="py-3 text-secondary text-uppercase small text-end"><i class="fas fa-euro-sign me-1"></i> Renta</th>
                                <th class="py-3 text-secondary text-uppercase small text-end"><i class="fas fa-briefcase me-1"></i> Paro</th>
                                <th class="pe-4 py-3 text-secondary text-uppercase small text-center">Previsión</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in records %}
                                <tr>
                                    <td class="ps-4">
                                        <div class="fw-bold text-dark">{{ p.municipio or 'Desconocido' }}</div>
                                        <div class="small text-muted"><i class="fas fa-map-marker-alt me-1 text-secondary"></i> {{ p.codigo_postal }}</div>
                                    </td>
                                    
                                    <td>
                                        <span class="badge bg-light text-dark border">
                                            {{ p.temperatura }}°C
                                        </span>
                                    </td>

                                    <td class="text-end text-muted font-monospace">
                                        {{ "{:,}".format(p.habitantes|int).replace(',', '.') if p.habitantes else '0' }}
                                    </td>
                                    <td class="text-end text-muted font-monospace">
                                        {{ "{:,.2f}".format(p.renta_media|float).replace(',', 'X').replace('.', ',').replace('X', '.') if p.renta_media else '0,00' }}€
                                    </td>
                                    <td class="text-end text-muted font-monospace">
                                        {{ p.paro_registrado or '0' }}
                                    </td>

                                    <td class="pe-4 text-center">
                                        {% if p.demanda %}
                                            <span class="badge rounded-pill px-3 py-2 demanda-badge demanda-{{ p.demanda.split(' ')[0] }}">
                                                {{ p.demanda }}
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary rounded-pill">Sin Datos</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <div class="mb-3">
                        <i class="fas fa-folder-open text-muted" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                    <h5 class="text-muted fw-bold">No hay registros</h5>
                    <p class="text-muted small">Realiza una predicción para comenzar a llenar el historial.</p>
                    <a href="/predict" class="btn btn-outline-primary btn-sm mt-2">Ir a Predecir</a>
                </div>
            {% endif %}

        </div>
    </div>

    <div class="mt-4 text-center">
        <a href="/predict" class="text-decoration-none text-muted small">
            <i class="fas fa-plus-circle me-1"></i> Realizar nueva predicción
        </a>
    </div>

</div>

<style>
    .demanda-badge {
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .demanda-Muy { background-color: #e9ecef; color: #495057; border: 1px solid #ced4da; }
    .demanda-Baja { background-color: #e3f2fd; color: #0d47a1; border: 1px solid #90caf9; }
    .demanda-Normal { background-color: #e8f5e9; color: #1b5e20; border: 1px solid #a5d6a7; }
    .demanda-Alta { background-color: #fff3e0; color: #e65100; border: 1px solid #ffcc80; }
    .demanda-Crítica, .demanda-Critica { background-color: #ffebee; color: #b71c1c; border: 1px solid #ef9a9a; }
</style>

{% endblock %}