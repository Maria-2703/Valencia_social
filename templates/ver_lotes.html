<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ver lotes</title>
    <style>
      body{font-family:Arial,Helvetica,sans-serif;padding:16px}
      table{border-collapse:collapse;width:100%;margin-top:12px}
      th,td{border:1px solid #ddd;padding:8px;text-align:left}
      .meta{margin-top:8px}
      a.button{display:inline-block;margin-right:8px;padding:6px 10px;background:#007bff;color:#fff;text-decoration:none;border-radius:4px}
    </style>
  </head>
  <body>
    <h1>Lotes del producto</h1>

    {% if item %}
      <p><strong>Nombre:</strong> {{ item.nombre or item.producto }}</p>
      <p class="meta"><strong>Categor√≠a:</strong> {{ item.categoria or '-' }} &nbsp; | &nbsp; <strong>Variante:</strong> {{ item.variante or '-' }} &nbsp; | &nbsp; <strong>Stock total:</strong> {{ item.stock_total or 0 }}</p>

      <div style="margin-top:12px">
        <a class="button" href="{{ url_for('crear_lote', item_id=item._id|string) }}">Crear lote</a>
        <a class="button" href="{{ url_for('editar_lote', item_id=item._id|string) }}">Editar lotes</a>
        <a style="margin-left:8px;" href="{{ url_for('inventario') }}">Volver al inventario</a>
      </div>

      <h2 style="margin-top:18px">Listado de lotes ({{ lotes|length }})</h2>

      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Lote ID</th>
            <th>Fecha entrada</th>
            <th>Fecha caducidad</th>
            <th>Unidades</th>
            <th>Coste</th>
          </tr>
        </thead>
        <tbody>
          {% for lote in lotes %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ lote.lote_id or '-' }}</td>
              <td>{% if lote.fecha_entrada %}{{ lote.fecha_entrada.strftime('%Y-%m-%d') }}{% else %}-{% endif %}</td>
              <td>{% if lote.fecha_caducidad %}{{ lote.fecha_caducidad.strftime('%Y-%m-%d') }}{% else %}-{% endif %}</td>
              <td>{{ lote.unidades or 0 }}</td>
              <td>{{ lote.coste or 0.0 }}</td>
            </tr>
          {% else %}
            <tr><td colspan="6">No hay lotes</td></tr>
          {% endfor %}
        </tbody>
      </table>

    {% else %}
      <p style="color:red">Producto no encontrado.</p>
      <p><a href="{{ url_for('inventario') }}">Volver al inventario</a></p>
    {% endif %}

  </body>
</html>
